<div class="chat-box centered flex-column">
  <div class="d-flex flex-row align-items-start w-100">
    <img class="mx-2" nz-image [ngSrc]="chatModel?.role==UserRole?'assets/programmer.png':'assets/chat-gpt.png'" width="20" height="20" alt="图标"/>
    <div class="mx-2">{{ chatModel?.role==UserRole?'You':'ChatGPT' }}</div>
  </div>
  <div class="flex-grow-1 centered px-5 my-2 w-100">
<!--    <button (click)="debugLog()">-->
<!--      click-->
<!--    </button>-->
    <div [ngSwitch]="type">
      <div *ngSwitchCase="GPTType.ChatStream">
        <div class="w-100" *ngFor="let segment of separatedSegments">
          <div  *ngIf="segment.isCode" class="w-100 d-flex flex-column">
            <div class="d-flex flex-row-reverse">
              <button class="rounded-5 border-0 bg-opacity-50 bg-dark text-white" (click)="copyCode(segment.content)">
                <span nz-icon nzType="copy" nzTheme="outline"></span><span style="font-size: 12px;">Copy code</span>
              </button>
            </div>
            <pre class="m-0 rounded-5 bg-light">
          <code class="pb-0 rounded-3" [highlight]="segment.content"></code>
        </pre>
          </div>
          <div *ngIf="!segment.isCode">
            {{segment.content}}
          </div>
        </div>
      </div>
      <div *ngSwitchCase="GPTType.Image">
        <div *ngIf="imageList!==undefined">
          <div *ngFor="let image of imageList!.images">

            <img nz-image width="300" height="300"
                 [nzFallback]="fallback"
                 [nzSrc]="autoShow(image)" alt="图片"/>
            <div>{{image.revised_prompt}}</div>
          </div>
        </div>
        <div *ngIf="errors()">
          {{chatModel?.content}} error.
        </div>
        <div *ngIf="loading()">
          <nz-spin nzSize="large" nzSimple></nz-spin>
        </div>
      </div>
      <div *ngSwitchDefault>null</div>
    </div>

  </div>
</div>
